# 数据库第十四章——TRANSACTION事物
## 事物
事物是访问并可能更新各种数据项的一个程序执行单元（unit）。
### 性质：
#### ⑴ 原子性（Atomicity）
　　原子性是指事务包含的所有操作要么全部成功，要么全部失败回滚，这和前面两篇博客介绍事务的功能是一样的概念，因此事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响。

#### ⑵ 一致性（Consistency）
　　一致性是指事务必须使数据库从一个一致性状态变换到另一个一致性状态，也就是说一个事务执行之前和执行之后都必须处于一致性状态。
　　拿转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性。

#### ⑶ 隔离性（Isolation）
　　隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离。
　　即要达到这么一种效果：对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行。
　　关于事务的隔离性数据库提供了多种隔离级别，稍后会介绍到。

#### ⑷ 持久性（Durability）
　　持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。
参考：[数据库事务的四大特性以及事务的隔离级别 - fjdingsd - 博客园](https://www.cnblogs.com/fjdingsd/p/5273008.html)

### 并发的理由
1.提高吞吐量

2.减少等待时间

### 可恢复调度
对于Ti与Tj，若Tj读取了Ti所写的内容，Ti应该在Tj之前commit。
### 无级联调度
对每对事务Ti与Tj，如果Tj读取了先前由Ti所写的数据项，则Ti必须在Tj这一读操作前提交。容易验证每一个无级联调度也都是可恢复的调度。
### 事物隔离性级别
1.serializable  可穿行化
通常保证可穿行化调度

2.repeatable read 可重复读
只允许读取已提交数据，而且在一个事物两次读取一个数据项期间，其他事物不的更新该数据。但该事物不要求与其他事物可穿行化。

3.read committed 
只允许读取已提交数据，但不要求可重复读。

4.read committed未提交读
允许读取未提交数据。

**以上的隔离性级别都不允许脏写，若一个数据已经被写且未被提交，就不能执行 写操作**

### 可穿行化调度疑问
可穿行化：穿行执行A——穿行执行B=可穿行化执行后效果与先执行A再执行B相同即可
